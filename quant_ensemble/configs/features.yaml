# Feature Engineering Configuration
# Defines all features used by the ensemble system

features:
  # Momentum features
  momentum:
    - name: ret_1w
      description: "1-week return"
      window: 5
      skip: 0

    - name: ret_1m
      description: "1-month return"
      window: 21
      skip: 0

    - name: ret_3m
      description: "3-month return"
      window: 63
      skip: 0

    - name: ret_6m
      description: "6-month return"
      window: 126
      skip: 0

    - name: ret_12m
      description: "12-month return"
      window: 252
      skip: 0

    - name: ret_12m_1m
      description: "12-1 month momentum (classic)"
      window: 252
      skip: 21

    - name: ret_6m_1m
      description: "6-1 month momentum"
      window: 126
      skip: 21

  # Value features
  value:
    - name: pbr
      description: "Price to Book Ratio"
      source: fundamentals
      bloomberg_field: PX_TO_BOOK_RATIO
      publish_lag_days: 2

    - name: per
      description: "Price to Earnings Ratio"
      source: fundamentals
      bloomberg_field: PE_RATIO
      publish_lag_days: 2

    - name: dividend_yield
      description: "Dividend Yield"
      source: fundamentals
      bloomberg_field: DVD_PAYOUT_RATIO
      publish_lag_days: 2

    - name: roe
      description: "Return on Equity"
      source: fundamentals
      bloomberg_field: RETURN_COM_EQY
      publish_lag_days: 2

    - name: debt_to_equity
      description: "Debt to Equity Ratio"
      source: fundamentals
      bloomberg_field: TOT_DEBT_TO_TOT_EQY
      publish_lag_days: 2

  # Volatility features
  volatility:
    - name: realized_vol_5d
      description: "5-day realized volatility"
      window: 5

    - name: realized_vol_20d
      description: "20-day realized volatility"
      window: 20

    - name: realized_vol_60d
      description: "60-day realized volatility"
      window: 60

    - name: vol_of_vol_20d
      description: "Volatility of volatility (20d)"
      window: 20

    - name: max_drawdown_20d
      description: "Maximum drawdown over 20 days"
      window: 20

    - name: max_drawdown_60d
      description: "Maximum drawdown over 60 days"
      window: 60

    - name: downside_vol_20d
      description: "Downside volatility (20d)"
      window: 20

  # Microstructure/Volume features
  microstructure:
    - name: volume_zscore_5d
      description: "5-day volume z-score"
      window: 5
      lookback: 60

    - name: volume_zscore_20d
      description: "20-day volume z-score"
      window: 20
      lookback: 252

    - name: turnover_zscore_20d
      description: "20-day turnover z-score"
      window: 20
      lookback: 252

    - name: amihud_illiquidity_20d
      description: "Amihud illiquidity measure (20d)"
      window: 20

    - name: foreign_flow_5d
      description: "5-day foreign net buying"
      window: 5

    - name: foreign_flow_20d
      description: "20-day foreign net buying"
      window: 20

    - name: inst_flow_5d
      description: "5-day institutional net buying"
      window: 5

    - name: inst_flow_20d
      description: "20-day institutional net buying"
      window: 20

  # Regime features (market-wide)
  regime:
    - name: market_ret_5d
      description: "Market 5-day return"
      ticker: "KOSPI2 Index"
      window: 5

    - name: market_ret_20d
      description: "Market 20-day return"
      ticker: "KOSPI2 Index"
      window: 20

    - name: market_vol_20d
      description: "Market 20-day volatility"
      ticker: "KOSPI2 Index"
      window: 20

    - name: vkospi
      description: "VKOSPI (Korean VIX)"
      ticker: "VKOSPI Index"

    - name: credit_spread
      description: "Credit spread (AA- vs Treasury)"
      derived: true

    - name: yield_curve_slope
      description: "Yield curve slope (10Y - 2Y)"
      derived: true

    - name: market_breadth
      description: "Advance-decline ratio"
      derived: true

    - name: correlation_avg
      description: "Average pairwise correlation"
      window: 20

# Normalization configuration
normalization:
  method: cross_sectional_zscore
  winsorize: true
  winsorize_limits: [0.01, 0.99]
  handle_missing: median  # Options: median, mean, zero, drop
  min_observations: 20    # Minimum observations for valid normalization

# Feature selection
feature_selection:
  enabled: false
  method: mutual_info  # Options: mutual_info, correlation, lasso
  top_k: 50
